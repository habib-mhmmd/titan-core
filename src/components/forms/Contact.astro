---
import Button from "@components/ui/Button.astro";
import Input from "@components/ui/form/Input.astro";
import Textarea from "@components/ui/form/Textarea.astro";
import { Send } from 'lucide-astro';

const formBackground = 'dark';
---

<form id="contact-form" class="space-y-6 bg-background-light p-6 rounded-[var(--border-radius-xlarge)]">
    <Textarea
        label="Message"
        id="message"
        name="message"
        required
        background={formBackground}
    />
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Input
            label="Name"
            id="name"
            name="name"
            required
            background={formBackground}
        />
        <Input
            label="Email"
            type="email"
            id="email"
            name="email"
            placeholder="you@example.com"
            required
            background={formBackground}
        />
    </div>

    <div class="grid grid-cols-1 mt-6 justify-items-end">
        <Button variant="secondary" type="submit" id="contact-submit">
            Send
            <Send class="w-4 h-4 ml-1" />
        </Button>
    </div>

</form>

<!-- <script>
  // Pastikan script ini berada setelah elemen <form>
  (function () {
    const form = document.querySelector("#contact-form");
    if (!form) return;

    const submitBtn = document.querySelector("#contact-submit");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!(form instanceof HTMLFormElement)) return;

      submitBtn?.setAttribute("disabled", "true");

      try {
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());

        const res = await fetch("/api/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const resJson = await res.json().catch(() => ({}));

        if (res.ok) {
          alert("✅ Email sent!");
          form.reset();
        } else {
          console.error("Server response:", res.status, resJson);
          alert("❌ Failed to send email. " + (resJson.message || ""));
        }
      } catch (err) {
        console.error("Fetch error:", err);
        alert("⚠️ Error submitting form. Cek console & server log.");
      } finally {
        submitBtn?.removeAttribute("disabled");
      }
    });
  })();
</script> -->

<!-- <script>
  (function () {
    const form = document.querySelector("#contact-form");
    if (!form) return;

    const submitBtn = document.querySelector("#contact-submit");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!(form instanceof HTMLFormElement)) return;
      submitBtn?.setAttribute("disabled", "true");

      try {
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());

        const res = await fetch("/api/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const resJson = await res.json().catch(() => ({}));

        if (res.ok) {
          alert("✅ Email sent!");
          form.reset();
        } else {
          console.error("Server response:", res.status, resJson);
          alert("❌ Failed to send email. " + (resJson.message || ""));
        }
      } catch (err) {
        console.error("Fetch error:", err);
        alert("⚠️ Error submitting form. Cek console & server log.");
      } finally {
        submitBtn?.removeAttribute("disabled");
      }
    });
  })();
</script> -->

<script>
  (function () {
    const form = document.querySelector("#contact-form");
    if (!form) return;
    const submitBtn = document.querySelector("#contact-submit");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!(form instanceof HTMLFormElement)) return;

      submitBtn?.setAttribute("disabled", "true");

      try {
        const formData = new FormData(form);
        const payload = Object.fromEntries(formData.entries());

        const res = await fetch("/api/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const resJson = await res.json().catch(() => ({}));

        if (res.ok) {
          alert("✅ Email sent!");
          form.reset();
        } else {
          console.error("Server response:", res.status, resJson);
          alert("❌ Failed to send email. " + (resJson.message || ""));
        }
      } catch (err) {
        console.error("Fetch error:", err);
        alert("⚠️ Error submitting form. Check console & server log.");
      } finally {
        submitBtn?.removeAttribute("disabled");
      }
    });
  })();
</script>